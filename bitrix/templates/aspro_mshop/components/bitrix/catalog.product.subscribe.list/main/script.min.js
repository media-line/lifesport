!function(a){if(!a.JCCatalogProductSubscribeList){var b=function(a){b.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},text:a.text}),this.buttonNode=BX.create("span",{attrs:{className:a.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")};BX.extend(b,BX.PopupWindowButton);var c=function(a){c.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{id:this.id},style:"object"==typeof a.style?a.style:{},text:a.text}),this.buttonNode=BX.create("span",{attrs:{className:a.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")};BX.extend(c,BX.PopupWindowButton),a.JCCatalogProductSubscribeList=function(a){if(this.skuVisualParams={SELECT:{TAG_BIND:"select",TAG:"option",ACTIVE_CLASS:"active",HIDE_CLASS:"hidden",EVENT:"change"},LI:{TAG_BIND:"li",TAG:"li",ACTIVE_CLASS:"active",HIDE_CLASS:"missing",EVENT:"click"}},this.productType=0,this.showQuantity=!0,this.showAbsent=!0,this.secondPict=!1,this.showOldPrice=!1,this.showPercent=!1,this.showSkuProps=!1,this.basketAction="ADD",this.showClosePopup=!1,this.useCompare=!1,this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""},this.product={checkQuantity:!1,maxQuantity:0,stepQuantity:1,isDblQuantity:!1,canBuy:!0,canSubscription:!0,name:"",pict:{},id:0,addUrl:"",buyUrl:"",listSubscribeId:{}},this.basketData={useProps:!1,emptyProps:!1,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""},this.compareData={compareUrl:"",comparePath:""},this.defaultPict={pict:null,secondPict:null},this.checkQuantity=!1,this.maxQuantity=0,this.stepQuantity=1,this.isDblQuantity=!1,this.canBuy=!0,this.currentBasisPrice={},this.canSubscription=!0,this.precision=6,this.precisionFactor=Math.pow(10,this.precision),this.offers=[],this.offerNum=0,this.treeProps=[],this.obTreeRows=[],this.showCount=[],this.showStart=[],this.selectedValues={},this.obProduct=null,this.obQuantity=null,this.obQuantityUp=null,this.obQuantityDown=null,this.obPict=null,this.obSecondPict=null,this.obPrice=null,this.obTree=null,this.obBuyBtn=null,this.deleteSubscribeBtn=null,this.obBasketBtn=null,this.obBasketActions=null,this.obNotAvail=null,this.obDscPerc=null,this.obSecondDscPerc=null,this.obSkuProps=null,this.obMeasure=null,this.obCompare=null,this.obPopupWin=null,this.basketUrl="",this.basketParams={},this.treeRowShowSize=5,this.treeEnableArrow={display:"",cursor:"pointer",opacity:1},this.treeDisableArrow={display:"",cursor:"default",opacity:.2},this.lastElement=!1,this.containerHeight=0,this.errorCode=0,this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe.list/ajax.php","object"==typeof a){if(this.productType=parseInt(a.PRODUCT_TYPE,10),this.showQuantity=a.SHOW_QUANTITY,this.showAbsent=a.SHOW_ABSENT,this.secondPict=!!a.SECOND_PICT,this.showOldPrice=!!a.SHOW_OLD_PRICE,this.showPercent=!!a.SHOW_DISCOUNT_PERCENT,this.showSkuProps=!!a.SHOW_SKU_PROPS,a.ADD_TO_BASKET_ACTION&&(this.basketAction=a.ADD_TO_BASKET_ACTION),this.showClosePopup=!!a.SHOW_CLOSE_POPUP,this.useCompare=!!a.DISPLAY_COMPARE,this.notifyUser=Boolean(a.NOTIFY_USER),this.notifyPopupTitle=a.NOTIFY_POPUP_TITLE,this.notifySuccess=Boolean(a.NOTIFY_SUCCESS),this.notifyMessage=a.NOTIFY_MESSAGE,this.notifyUser)return void BX.ready(BX.delegate(this.showPopupNotifyingUser,this));switch(this.visual=a.VISUAL,this.visual.DELETE_SUBSCRIBE_ID&&(this.deleteSubscribeBtn=BX(this.visual.DELETE_SUBSCRIBE_ID),this.deleteSubscribeBtn&&BX.bind(this.deleteSubscribeBtn,"click",BX.delegate(this.deleteSubscribe,this)),this.product.listSubscribeId=a.PRODUCT.LIST_SUBSCRIBE_ID),this.productType){case 1:case 2:a.PRODUCT&&"object"==typeof a.PRODUCT?(this.showQuantity&&(this.product.checkQuantity=a.PRODUCT.CHECK_QUANTITY,this.product.isDblQuantity=a.PRODUCT.QUANTITY_FLOAT,this.product.checkQuantity&&(this.product.maxQuantity=this.product.isDblQuantity?parseFloat(a.PRODUCT.MAX_QUANTITY):parseInt(a.PRODUCT.MAX_QUANTITY,10)),this.product.stepQuantity=this.product.isDblQuantity?parseFloat(a.PRODUCT.STEP_QUANTITY):parseInt(a.PRODUCT.STEP_QUANTITY,10),this.checkQuantity=this.product.checkQuantity,this.isDblQuantity=this.product.isDblQuantity,this.maxQuantity=this.product.maxQuantity,this.stepQuantity=this.product.stepQuantity,this.isDblQuantity&&(this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor)),this.product.canBuy=a.PRODUCT.CAN_BUY,this.product.canSubscription=a.PRODUCT.SUBSCRIPTION,this.canBuy=this.product.canBuy,this.canSubscription=this.product.canSubscription,this.product.name=a.PRODUCT.NAME,this.product.pict=a.PRODUCT.PICT,this.product.id=a.PRODUCT.ID,a.PRODUCT.ADD_URL&&(this.product.addUrl=a.PRODUCT.ADD_URL),a.PRODUCT.BUY_URL&&(this.product.buyUrl=a.PRODUCT.BUY_URL),a.BASKET&&"object"==typeof a.BASKET&&(this.basketData.useProps=!!a.BASKET.ADD_PROPS,this.basketData.emptyProps=!!a.BASKET.EMPTY_PROPS)):this.errorCode=-1;break;case 3:a.OFFERS&&BX.type.isArray(a.OFFERS)?(a.PRODUCT&&"object"==typeof a.PRODUCT&&(this.product.name=a.PRODUCT.NAME,this.product.id=a.PRODUCT.ID),this.offers=a.OFFERS,this.offerNum=0,a.OFFER_SELECTED&&(this.offerNum=parseInt(a.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),a.TREE_PROPS&&(this.treeProps=a.TREE_PROPS),a.DEFAULT_PICTURE&&(this.defaultPict.pict=a.DEFAULT_PICTURE.PICTURE,this.defaultPict.secondPict=a.DEFAULT_PICTURE.PICTURE_SECOND)):this.errorCode=-1;break;default:this.errorCode=-1}a.BASKET&&"object"==typeof a.BASKET&&(a.BASKET.QUANTITY&&(this.basketData.quantity=a.BASKET.QUANTITY),a.BASKET.PROPS&&(this.basketData.props=a.BASKET.PROPS),a.BASKET.BASKET_URL&&(this.basketData.basketUrl=a.BASKET.BASKET_URL),3===this.productType&&a.BASKET.SKU_PROPS&&(this.basketData.sku_props=a.BASKET.SKU_PROPS)),this.useCompare&&(a.COMPARE&&"object"==typeof a.COMPARE?(a.COMPARE.COMPARE_PATH&&(this.compareData.comparePath=a.COMPARE.COMPARE_PATH),a.COMPARE.COMPARE_URL_TEMPLATE_DEL&&(this.compareData.compareUrlDel=a.COMPARE.COMPARE_URL_TEMPLATE_DEL),a.COMPARE.COMPARE_URL_TEMPLATE?this.compareData.compareUrl=a.COMPARE.COMPARE_URL_TEMPLATE:this.useCompare=!1):this.useCompare=!1),this.lastElement=!!a.LAST_ELEMENT&&"Y"===a.LAST_ELEMENT}0===this.errorCode&&BX.ready(BX.delegate(this.Init,this))},a.JCCatalogProductSubscribeList.prototype.Init=function(){var b=0,c="",d=null;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.obPict=BX(this.visual.PICT_ID),this.obPict||(this.errorCode=-2),this.secondPict&&this.visual.SECOND_PICT_ID&&(this.obSecondPict=BX(this.visual.SECOND_PICT_ID)),this.storeQuanity=BX(this.visual.STORE_QUANTITY),this.obPrice=BX(this.visual.PRICE_ID),this.obPriceOld=BX(this.visual.PRICE_OLD_ID),this.obPrice||(this.errorCode=-16),this.showQuantity&&this.visual.QUANTITY_ID&&(this.obQuantity=BX(this.visual.QUANTITY_ID),this.visual.QUANTITY_UP_ID&&(this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)),this.visual.QUANTITY_DOWN_ID&&(this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID))),3===this.productType){if(this.visual.TREE_ID)for(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256),c=this.visual.TREE_ITEM_ID,b=0;b<this.treeProps.length;b++)if(this.obTreeRows[b]={LIST:BX(c+this.treeProps[b].ID+"_list"),CONT:BX(c+this.treeProps[b].ID+"_cont")},!this.obTreeRows[b].LIST||!this.obTreeRows[b].CONT){this.errorCode=-512;break}this.visual.QUANTITY_MEASURE&&(this.obMeasure=BX(this.visual.QUANTITY_MEASURE))}if(this.visual.BUY_ID&&(this.obBuyBtn=BX(this.visual.BUY_ID)),this.showPercent&&(this.visual.DSC_PERC&&(this.obDscPerc=BX(this.visual.DSC_PERC)),this.secondPict&&this.visual.SECOND_DSC_PERC&&(this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC))),this.showSkuProps&&this.visual.DISPLAY_PROP_DIV&&(this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)),0===this.errorCode){switch(this.showQuantity&&(this.obQuantityUp&&BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this)),this.obQuantityDown&&BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this)),this.obQuantity&&BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))),this.productType){case 1:break;case 3:for(var e in this.skuVisualParams){var d=BX.findChildren(this.obTree,{tagName:this.skuVisualParams[e].TAG_BIND},!0);if(d&&0<d.length)for(b=0;b<d.length;b++)$(d[b]).on(this.skuVisualParams[e].EVENT,BX.delegate(this.SelectOfferProp,this))}this.SetCurrent()}this.obBuyBtn&&("ADD"===this.basketAction||BX.bind(this.obBuyBtn,"click",BX.delegate(this.BuyBasket,this))),this.useCompare&&(this.obCompare=BX(this.visual.COMPARE_LINK_ID)),this.lastElement&&(this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10),isNaN(this.containerHeight)&&(this.containerHeight=0),this.setHeight(),BX.bind(a,"resize",BX.delegate(this.checkHeight,this)),BX.bind(this.obProduct.parentNode,"mouseover",BX.delegate(this.setHeight,this)),BX.bind(this.obProduct.parentNode,"mouseout",BX.delegate(this.clearHeight,this)))}},a.JCCatalogProductSubscribeList.prototype.showPopupNotifyingUser=function(){this.InitPopupWindow(),this.obPopupWin.setTitleBar(this.notifyPopupTitle);var a;a=this.notifySuccess?"bx-cpsl-notify-content-success":"bx-cpsl-notify-content-error";var b=BX.create("div",{props:{className:"bx-cpsl-popup-content"},children:[BX.create("p",{props:{className:a},text:this.notifyMessage})]});this.obPopupWin.setContent(b),this.obPopupWin.setButtons([new c({text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),className:"btn btn-primary",events:{click:BX.delegate(function(){this.obPopupWin.close()},this)}})]),this.obPopupWin.show()},a.JCCatalogProductSubscribeList.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10),isNaN(this.containerHeight)&&(this.containerHeight=0)},a.JCCatalogProductSubscribeList.prototype.setHeight=function(){0<this.containerHeight&&BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})},a.JCCatalogProductSubscribeList.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})},a.JCCatalogProductSubscribeList.prototype.QuantityUp=function(){var a=0,b=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(a=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(a)||(a+=this.stepQuantity,this.checkQuantity&&a>this.maxQuantity&&(b=!1),b&&(this.isDblQuantity&&(a=Math.round(a*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=a)))},a.JCCatalogProductSubscribeList.prototype.QuantityDown=function(){var a=0,b=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(a=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(a)||(a-=this.stepQuantity,a<this.stepQuantity&&(b=!1),b&&(this.isDblQuantity&&(a=Math.round(a*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=a)))},a.JCCatalogProductSubscribeList.prototype.QuantityChange=function(){var a=0,b=!0;0===this.errorCode&&this.showQuantity&&(this.canBuy?(a=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(a)?this.obQuantity.value=this.stepQuantity:(this.checkQuantity&&(a>this.maxQuantity?(b=!1,a=this.maxQuantity):a<this.stepQuantity&&(b=!1,a=this.stepQuantity)),b||(this.obQuantity.value=a))):this.obQuantity.value=this.stepQuantity)},a.JCCatalogProductSubscribeList.prototype.QuantitySet=function(a){0===this.errorCode&&this.showQuantity&&(this.isDblQuantity=this.offers[a].QUANTITY_FLOAT,this.checkQuantity=this.offers[a].CHECK_QUANTITY,this.isDblQuantity?(this.maxQuantity=parseFloat(this.offers[a].MAX_QUANTITY),this.stepQuantity=Math.round(parseFloat(this.offers[a].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor):(this.maxQuantity=parseInt(this.offers[a].MAX_QUANTITY,10),this.stepQuantity=parseInt(this.offers[a].STEP_QUANTITY,10)),this.obQuantity.value=this.stepQuantity,this.obQuantity.disabled=!this.canBuy,this.obMeasure&&(this.offers[a].MEASURE?BX.adjust(this.obMeasure,{html:this.offers[a].MEASURE}):BX.adjust(this.obMeasure,{html:""})))},a.JCCatalogProductSubscribeList.prototype.SelectOfferProp=function(){var a=0,b="",c="",d=[],e=null,f=BX.proxy_context;if("undefined"!=typeof f.options&&"undefined"!=typeof f.options[f.selectedIndex]&&(f=f.options[f.selectedIndex]),f&&f.hasAttribute("data-treevalue")&&(c=f.getAttribute("data-treevalue"),propModes=f.getAttribute("data-showtype"),d=c.split("_"),this.SearchOfferPropIndex(d[0],d[1])&&(e=BX.findChildren(f.parentNode,{tagName:this.skuVisualParams[propModes.toUpperCase()].TAG},!1),e&&0<e.length)))for(a=0;a<e.length;a++)b=e[a].getAttribute("data-onevalue"),"TEXT"==propModes?b===d[1]?e[a].setAttribute("selected","selected"):e[a].removeAttribute("selected"):b===d[1]?$(e[a]).addClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS):$(e[a]).removeClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS)},a.JCCatalogProductSubscribeList.prototype.SearchOfferPropIndex=function(a,b){var e,f,c="",d=!1,g=[],h=[],i=-1,j={},k=[];for(e=0;e<this.treeProps.length;e++)if(this.treeProps[e].ID===a){i=e;break}if(-1<i){for(e=0;e<i;e++)c="PROP_"+this.treeProps[e].ID,j[c]=this.selectedValues[c];if(c="PROP_"+this.treeProps[i].ID,d=this.GetRowValues(j,c),!d)return!1;if(!BX.util.in_array(b,d))return!1;for(j[c]=b,e=i+1;e<this.treeProps.length;e++){if(c="PROP_"+this.treeProps[e].ID,d=this.GetRowValues(j,c),!d)return!1;if(h=[],this.showAbsent)for(g=[],k=[],k=BX.clone(j,!0),f=0;f<d.length;f++)k[c]=d[f],h[h.length]=d[f],g[g.length]=d[f];else g=d;this.selectedValues[c]&&BX.util.in_array(this.selectedValues[c],g)?j[c]=this.selectedValues[c]:this.showAbsent?j[c]=g.length>0?g[0]:h[0]:j[c]=g[0],this.UpdateRow(e,j[c],d,g)}this.selectedValues=j,this.ChangeInfo()}return!0},a.JCCatalogProductSubscribeList.prototype.RowLeft=function(){var a=0,b="",c=-1,d=BX.proxy_context;if(d&&d.hasAttribute("data-treevalue")){for(b=d.getAttribute("data-treevalue"),a=0;a<this.treeProps.length;a++)if(this.treeProps[a].ID===b){c=a;break}-1<c&&this.treeRowShowSize<this.showCount[c]&&(0>this.showStart[c]&&(this.showStart[c]++,BX.adjust(this.obTreeRows[c].LIST,{style:{marginLeft:20*this.showStart[c]+"%"}}),BX.adjust(this.obTreeRows[c].RIGHT,{style:this.treeEnableArrow})),0<=this.showStart[c]&&BX.adjust(this.obTreeRows[c].LEFT,{style:this.treeDisableArrow}))}},a.JCCatalogProductSubscribeList.prototype.RowRight=function(){var a=0,b="",c=-1,d=BX.proxy_context;if(d&&d.hasAttribute("data-treevalue")){for(b=d.getAttribute("data-treevalue"),a=0;a<this.treeProps.length;a++)if(this.treeProps[a].ID===b){c=a;break}-1<c&&this.treeRowShowSize<this.showCount[c]&&(this.treeRowShowSize-this.showStart[c]<this.showCount[c]&&(this.showStart[c]--,BX.adjust(this.obTreeRows[c].LIST,{style:{marginLeft:20*this.showStart[c]+"%"}}),BX.adjust(this.obTreeRows[c].LEFT,{style:this.treeEnableArrow})),this.treeRowShowSize-this.showStart[c]>=this.showCount[c]&&BX.adjust(this.obTreeRows[c].RIGHT,{style:this.treeDisableArrow}))}},a.JCCatalogProductSubscribeList.prototype.UpdateRow=function(a,b,c,d){var e=0,f=0,g="",h=0,j={},m=!1,n=0,q=(this.treeEnableArrow,this.treeEnableArrow,0),r=null;if(-1<a&&a<this.obTreeRows.length&&(propMode=this.treeProps[a].DISPLAY_TYPE,r=BX.findChildren(this.obTreeRows[a].LIST,{tagName:this.skuVisualParams[propMode].TAG},!1),r&&0<r.length)){for(selectMode="SELECT"===this.treeProps[a].DISPLAY_TYPE,h=c.length,j={style:{},props:{disabled:"",selected:""}},e=0;e<r.length;e++)g=r[e].getAttribute("data-onevalue"),m=g===b&&0!=g,j.props.className=m?this.skuVisualParams[propMode].ACTIVE_CLASS:"",selectMode?(j.props.disabled="disabled",j.props.selected=m?"selected":""):j.style.display="none",BX.util.in_array(g,c)&&(selectMode?j.props.disabled="":j.style.display="",m&&(n=f),f++),BX.adjust(r[e],j);selectMode&&$(this.obTreeRows[a].LIST).parent().hasClass("ik_select")&&$(this.obTreeRows[a].LIST).ikSelect("reset"),this.showCount[a]=h,this.showStart[a]=q}},a.JCCatalogProductSubscribeList.prototype.GetRowValues=function(a,b){var d,c=0,e=[],f=!1,g=!0;if(0===a.length){for(c=0;c<this.offers.length;c++)BX.util.in_array(this.offers[c].TREE[b],e)||(e[e.length]=this.offers[c].TREE[b]);f=!0}else for(c=0;c<this.offers.length;c++){g=!0;for(d in a)if(a[d]!==this.offers[c].TREE[d]){g=!1;break}g&&(BX.util.in_array(this.offers[c].TREE[b],e)||(e[e.length]=this.offers[c].TREE[b]),f=!0)}return!!f&&e},a.JCCatalogProductSubscribeList.prototype.GetCanBuy=function(a){var c,b=0,d=!1,e=!0;for(b=0;b<this.offers.length;b++){e=!0;for(c in a)if(a[c]!==this.offers[b].TREE[c]){e=!1;break}if(e&&this.offers[b].CAN_BUY){d=!0;break}}return d},a.JCCatalogProductSubscribeList.prototype.SetCurrent=function(){var a=0,b=0,c=[],d="",e=!1,f={},g=[],h=this.offers[this.offerNum].TREE;for(a=0;a<this.treeProps.length&&(d="PROP_"+this.treeProps[a].ID,e=this.GetRowValues(f,d),e);a++){if(BX.util.in_array(h[d],e)?f[d]=h[d]:(f[d]=e[0],this.offerNum=0),this.showAbsent)for(c=[],g=[],g=BX.clone(f,!0),b=0;b<e.length;b++)g[d]=e[b],this.GetCanBuy(g)&&(c[c.length]=e[b]);else c=e;this.UpdateRow(a,f[d],e,c)}this.selectedValues=f,this.ChangeInfo()},a.JCCatalogProductSubscribeList.prototype.ChangeInfo=function(){var c,b=0,d=-1,e={},g=!0;for(b=0;b<this.offers.length;b++){g=!0;for(c in this.selectedValues)if(this.selectedValues[c]!==this.offers[b].TREE[c]){g=!1;break}if(g){d=b;break}}if(-1<d){if(this.obPict){var e={attrs:{}};this.offers[d].PREVIEW_PICTURE?e.attrs.src=this.offers[d].PREVIEW_PICTURE.SRC:e.attrs.src=this.defaultPict.pict.SRC,BX.adjust(BX.findChild(this.obPict,{tag:"img"}),e)}this.secondPict&&this.obSecondPict&&(this.offers[d].PREVIEW_PICTURE_SECOND?BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[d].PREVIEW_PICTURE_SECOND.SRC+")"}}):this.offers[d].PREVIEW_PICTURE.SRC?BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.offers[d].PREVIEW_PICTURE.SRC+")"}}):this.defaultPict.secondPict?BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.secondPict.SRC+")"}}):BX.adjust(this.obSecondPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})),this.showSkuProps&&this.obSkuProps&&(0===this.offers[d].DISPLAY_PROPERTIES.length?BX.adjust(this.obSkuProps,{style:{display:"none"},html:""}):BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[d].DISPLAY_PROPERTIES})),$(this.obBuyBtn).data("item",this.offers[d].ID),$(this.obBasketBtn).data("item",this.offers[d].ID),$(this.obBasketActions).closest(".counter_wrapp").css("opacity",0);var i=this.offers[d].MEASURE&&"Y"==this.offers[d].SHOW_MEASURE?this.offers[d].MEASURE:"";this.setPrice(this.offers[d].PRICE,i),this.setQuantityStore(this.offers[d].MAX_QUANTITY,this.offers[d].AVAILIABLE.TEXT),this.offerNum=d,this.QuantitySet(this.offerNum),$(this.obProduct).find(".item-title a").attr("href",this.offers[this.offerNum].URL),$(this.obProduct).find(".image_wrapper_block > a").attr("href",this.offers[this.offerNum].URL),$(this.obProduct).find(".quantity_block .values").length&&$(this.obProduct).find(".quantity_block .values .item span.value").text(this.offers[d].MAX_QUANTITY).css({opacity:"1"});var j=this.offers[d],k=$(this.obProduct);"undefined"!=typeof arBasketAspro?this.setActualDataBlock(k,j):"undefined"!=typeof a.frameCacheVars&&BX.addCustomEvent("onFrameDataReceived",function(){a.JCCatalogProductSubscribeList.prototype.setActualDataBlock(k,j)})}},a.JCCatalogProductSubscribeList.prototype.setActualDataBlock=function(a,b){this.setLikeBlock(a,".like_icons .compare_item_button",b,"COMPARE"),this.setBuyBlock(a,b)},a.JCCatalogProductSubscribeList.prototype.setLikeBlock=function(a,b,c,d){var e=a;"DELAY"==d&&(c.CAN_BUY?e.find(b).css("display","block"):e.find(b).hide()),e.find(b).attr("data-item",c.ID),e.find(b).find("span").attr("data-item",c.ID),arBasketAspro[d]&&(e.find(b).find(".to").removeClass("added").css("display","block"),e.find(b).find(".in").hide(),void 0!==arBasketAspro[d][c.ID]&&(e.find(b).find(".to").hide(),e.find(b).find(".in").addClass("added").css("display","block")))},a.JCCatalogProductSubscribeList.prototype.setBuyBlock=function(a,b){var c=a.find(".offer_buy_block");if(c.find(".counter_wrapp .counter_block").length&&c.find(".counter_wrapp .counter_block").attr("data-item",b.ID),b.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL&&"ADD"==b.CONFIG.ACTION&&b.CAN_BUY){var d=b.CONFIG.MAX_QUANTITY_BUY>0?"data-max='"+b.CONFIG.MAX_QUANTITY_BUY+"'":"",e='<span class="minus">-</span><input type="text" class="text" name="'+b.PRODUCT_QUANTITY_VARIABLE+'" value="'+b.CONFIG.MIN_QUANTITY_BUY+'" /><span class="plus" '+d+">+</span>";arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[b.ID]?c.find(".counter_wrapp .counter_block").length?c.find(".counter_wrapp .counter_block").hide():(c.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+b.ID+'"></div>'),c.find(".counter_wrapp .counter_block").html(e).hide()):c.find(".counter_wrapp .counter_block").length?c.find(".counter_wrapp .counter_block").html(e).show():(c.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+b.ID+'"></div>'),c.find(".counter_wrapp .counter_block").html(e))}else c.find(".counter_wrapp .counter_block").length&&c.find(".counter_wrapp .counter_block").hide();var f="ORDER"==b.CONFIG.ACTION||!b.CAN_BUY||!b.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL||"SUBSCRIBE"==b.CONFIG.ACTION&&"Y"==b.CATALOG_SUBSCRIBE?"wide":"";$('<div class="button_block"></div>');if(c.find(".counter_wrapp").find(".button_block").length?arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[b.ID]?(c.find(".counter_wrapp").find(".button_block").addClass("wide").html(b.HTML),markProductAddBasket(b.ID)):f?(c.find(".counter_wrapp").find(".button_block").addClass("wide").html(b.HTML),arBasketAspro.SUBSCRIBE&&void 0!==arBasketAspro.SUBSCRIBE[b.ID]&&markProductSubscribe(b.ID)):c.find(".counter_wrapp").find(".button_block").removeClass("wide").html(b.HTML):(c.find(".counter_wrapp").append('<div class="button_block '+f+'">'+b.HTML+"</div>"),arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[b.ID]&&markProductAddBasket(b.ID),arBasketAspro.SUBSCRIBE&&void 0!==arBasketAspro.SUBSCRIBE[b.ID]&&markProductSubscribe(b.ID)),"NOTHING"!==b.CONFIG.ACTION)if("ADD"==b.CONFIG.ACTION&&b.CAN_BUY&&"N"!=b.SHOW_ONE_CLICK_BUY){var h='<span class="transparent big_btn type_block button one_click" data-offers="Y" data-item="'+b.ID+'" data-iblockID="'+b.IBLOCK_ID+'" data-quantity="'+b.CONFIG.MIN_QUANTITY_BUY+'" data-props="'+b.OFFER_PROPS+'" onclick="oneClickBuy('+b.ID+", "+b.IBLOCK_ID+', this)"><span>'+b.ONE_CLICK_BUY+"</span></span>";c.find(".wrapp_one_click").length?c.find(".wrapp_one_click").html(h):c.append('<div class="wrapp_one_click">'+h+"</div>")}else c.find(".wrapp_one_click").length&&c.find(".wrapp_one_click").remove();else c.find(".wrapp_one_click").length&&c.find(".wrapp_one_click").remove();c.fadeIn()},a.JCCatalogProductSubscribeList.prototype.setPrice=function(a,b){var c;this.obPrice&&(c=BX.Currency.currencyFormat(a.DISCOUNT_VALUE,a.CURRENCY,!0),b&&(c=c?c+"/"+b:"&nbsp;"),BX.adjust(this.obPrice,{html:c}),a.DISCOUNT_VALUE!==a.VALUE&&this.showOldPrice?($(this.obPriceOld).find("span").show().html(BX.Currency.currencyFormat(a.VALUE,a.CURRENCY,!0)),this.showPercent&&($(this.obPriceOld).closest(".cost").find(".sale_block").show(),$(this.obPriceOld).closest(".cost").find(".value").html(a.DISCOUNT_DIFF_PERCENT_RAW),$(this.obPriceOld).closest(".cost").find(".text span").html(BX.Currency.currencyFormat(a.DISCOUNT_DIFF,a.CURRENCY,!0)))):($(this.obPriceOld).find("strike").hide().html(""),this.showPercent&&$(this.obPriceOld).closest(".cost").find(".sale_block").hide()))},a.JCCatalogProductSubscribeList.prototype.setQuantityStore=function(a,b){parseFloat(a)>0?$(this.storeQuanity).find(".icon").removeClass("order").addClass("stock"):$(this.storeQuanity).find(".icon").removeClass("stock").addClass("order"),$(this.storeQuanity).find(".icon + span").html(b)},a.JCCatalogProductSubscribeList.prototype.InitBasketUrl=function(){switch(this.productType){case 1:case 2:this.basketUrl=this.product.addUrl;break;case 3:this.basketUrl=this.offers[this.offerNum].ADD_URL}this.basketParams={ajax_basket:"Y"},this.showQuantity&&(this.basketParams[this.basketData.quantity]=this.obQuantity.value)},a.JCCatalogProductSubscribeList.prototype.FillBasketProps=function(){if(this.visual.BASKET_PROP_DIV){var a=0,b=null,c=!1,d=null;if(this.basketData.useProps&&!this.basketData.emptyProps?this.obPopupWin&&this.obPopupWin.contentContainer&&(d=this.obPopupWin.contentContainer):d=BX(this.visual.BASKET_PROP_DIV),d){if(b=d.getElementsByTagName("select"),b&&b.length)for(a=0;a<b.length;a++)if(!b[a].disabled)switch(b[a].type.toLowerCase()){case"select-one":this.basketParams[b[a].name]=b[a].value,c=!0}if(b=d.getElementsByTagName("input"),b&&b.length)for(a=0;a<b.length;a++)if(!b[a].disabled)switch(b[a].type.toLowerCase()){case"hidden":this.basketParams[b[a].name]=b[a].value,c=!0;break;case"radio":b[a].checked&&(this.basketParams[b[a].name]=b[a].value,c=!0)}c||(this.basketParams[this.basketData.props]=[],this.basketParams[this.basketData.props][0]=0)}}},a.JCCatalogProductSubscribeList.prototype.SendToBasket=function(){this.canBuy&&(this.InitBasketUrl(),this.FillBasketProps(),BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this)))},a.JCCatalogProductSubscribeList.prototype.Basket=function(){var a="";if(this.canBuy)switch(this.productType){case 1:case 2:this.basketData.useProps&&!this.basketData.emptyProps?(this.InitPopupWindow(),this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_BASKET_PROPS")),BX(this.visual.BASKET_PROP_DIV)&&(a=BX(this.visual.BASKET_PROP_DIV).innerHTML),this.obPopupWin.setContent(a),this.obPopupWin.setButtons([new b({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]),this.obPopupWin.show()):this.SendToBasket();break;case 3:this.SendToBasket()}},a.JCCatalogProductSubscribeList.prototype.BasketResult=function(a){var f,c="",d="",e="",g=[];if(this.obPopupWin&&this.obPopupWin.close(),BX.type.isPlainObject(a)){if(f="OK"===a.STATUS){switch(BX.onCustomEvent("OnBasketChange"),d=this.product.name,this.productType){case 1:case 2:e=this.product.pict.SRC;break;case 3:e=this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC}c='<div style="width: 100%; margin: 0; text-align: center;"><img src="'+e+'" height="130" style="max-height:130px"><p>'+d+"</p></div>",g=[new b({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(function(){location.href=this.basketData.basketUrl?this.basketData.basketUrl:BX.message("CPSL_BASKET_URL")},this)}})]}else c=a.MESSAGE?a.MESSAGE:BX.message("CPSL_BASKET_UNKNOWN_ERROR"),g=[new b({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})];this.InitPopupWindow(),this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_ERROR")),this.obPopupWin.setContent(c),this.obPopupWin.setButtons(g),this.obPopupWin.show()}},a.JCCatalogProductSubscribeList.prototype.InitPopupWindow=function(){this.obPopupWin||(this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:!1,offsetLeft:0,offsetTop:0,overlay:!0,closeByEsc:!0,titleBar:!0,closeIcon:!0,contentColor:"white"}))},a.JCCatalogProductSubscribeList.prototype.deleteSubscribe=function(){var a,b;switch(this.productType){case 1:case 2:a=this.product.id;break;case 3:var c,d,e;if(!this.offers.length){a=this.product.id;break}for(c=0;c<this.offers.length;c++){e=!0;for(d in this.selectedValues)if(this.selectedValues[d]!==this.offers[c].TREE[d]){e=!1;break}if(e){b=c,a=this.offers[c].ID;break}}}a&&this.product.listSubscribeId.hasOwnProperty(a)&&BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),deleteSubscribe:"Y",itemId:a,listSubscribeId:this.product.listSubscribeId[a]},onsuccess:BX.delegate(function(a){a.success?(this.showWindowWithAnswer({status:"success"}),location.reload()):this.showWindowWithAnswer({status:"error",message:a.message})},this)})},a.JCCatalogProductSubscribeList.prototype.showWindowWithAnswer=function(a){a=a||{},a.message||("success"==a.status?a.message=BX.message("CPSL_STATUS_SUCCESS"):a.message=BX.message("CPSL_STATUS_ERROR"));var b=BX.create("div",{props:{className:"bx-catalog-subscribe-alert"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:a.message}),BX.create("div",{props:{className:"bx-catalog-subscribe-alert-footer"}})]}),c=BX.PopupWindowManager.getCurrentPopup();c&&c.destroy();var d=setTimeout(function(){var a=BX.PopupWindowManager.getCurrentPopup();a&&"bx-catalog-subscribe-status-action"==a.uniquePopupId&&(a.close(),a.destroy())},3500),e=BX.PopupWindowManager.create("bx-catalog-subscribe-status-action",null,{content:b,onPopupClose:function(){this.destroy(),clearTimeout(d)},autoHide:!0,zIndex:2e3,className:"bx-catalog-subscribe-alert-popup"});e.show(),BX("bx-catalog-subscribe-status-action").onmouseover=function(a){clearTimeout(d)},BX("bx-catalog-subscribe-status-action").onmouseout=function(a){d=setTimeout(function(){var a=BX.PopupWindowManager.getCurrentPopup();a&&"bx-catalog-subscribe-status-action"==a.uniquePopupId&&(a.close(),a.destroy())},3500)}}}}(window);