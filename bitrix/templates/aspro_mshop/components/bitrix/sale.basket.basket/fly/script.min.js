function setQuantity(t,a,e){var o,i=parseFloat(BX("QUANTITY_INPUT_"+t).value);a=parseFloat(a),o="up"==e?i+a:i-a,0>o&&(o=0),o>0&&(BX("QUANTITY_INPUT_"+t).value=o,BX("QUANTITY_INPUT_"+t).defaultValue=i,totalSum=0,$("#basket_line .basket_fly tr[data-id="+t+"]").closest("table").find("tbody tr[data-id]").each(function(t,a){id=$(a).attr("data-id"),count=BX("QUANTITY_INPUT_"+id).value,price=$(document).find("#basket_form input[name=item_price_"+id+"]").val(),sum=count*price,totalSum+=sum,$(document).find("#basket_form [data-id="+id+"] .summ-cell .price").html(jsPriceFormat(sum))}),$("#basket_form .itog span.price").html(jsPriceFormat(totalSum)),$("#basket_form .itog div.discount").fadeTo("slow",.2),timerBasketUpdate&&(clearTimeout(timerBasketUpdate),timerBasketUpdate=!1),timerBasketUpdate=setTimeout(function(){updateQuantity("QUANTITY_INPUT_"+t,t,a),timerBasketUpdate=!1},700))}function updateQuantity(t,a,e,o){var i=BX(t).defaultValue,s=parseFloat(BX(t).value)||0;if(bValidChange=!1,s||(bValidChange=!1,BX(t).value=i),0==e||1==e)bValidChange=!0;else{var n=1e4*s,d=1e4*e,r=n%d;0==r&&(bValidChange=!0)}if($("#"+t).hasClass("focus")&&(s-=s%e),s=0==e||1==e?parseInt(s):parseFloat(s).toFixed(1),isRealValue(BX("QUANTITY_SELECT_"+a)))var l,u=BX("QUANTITY_SELECT_"+a).options,c=u.length;for(;c--;)l=u[c],parseFloat(l.value).toFixed(2)==parseFloat(s).toFixed(2)&&(l.selected=!0);BX("QUANTITY_"+a).value=s,BX("QUANTITY_INPUT_"+a).value=s,$("form[name^=basket_form]").prepend('<input type="hidden" name="BasketRefresh" value="Y" />'),$.post(arMShopOptions.SITE_DIR+"ajax/show_basket.php",$("form[name^=basket_form]").serialize(),$.proxy(function(t){0==timerBasketUpdate&&basketFly("open"),$("form[name^=basket_form] input[name=BasketRefresh]").remove()}))}function delete_all_items(t,a,e){$.post(arMShopOptions.SITE_DIR+"ajax/show_basket_fly.php","PARAMS="+$("#basket_form").find("input#fly_basket_params").val()+"&TYPE="+t+"&CLEAR_ALL=Y",$.proxy(function(t){basketFly("open"),$(".in-cart").hide(),$(".in-cart").closest(".button_block").removeClass("wide"),$(".to-cart").show(),$(".counter_block").show(),$(".wish_item").removeClass("added"),$(".wish_item").find(".value").show(),$(".wish_item").find(".value.added").hide(),$(".iblockid").length&&getActualBasket($(".iblockid").data("iblockid"))}))}function deleteProduct(t,a,e,o){function i(t,a){$.post(arMShopOptions.SITE_DIR+"ajax/show_basket.php?action=delete&id="+t,$.proxy(function(t){basketFly("open"),o.attr("data-iblockid")&&getActualBasket(o.attr("data-iblockid"))}))}checkCounters()?(delFromBasketCounter(e),setTimeout(function(){i(t,a)},100)):i(t,a)}function delayProduct(t,a,e){$.post(arMShopOptions.SITE_DIR+"ajax/show_basket.php?action=delay&id="+t,$.proxy(function(t){basketFly("open"),e.attr("data-iblockid")&&getActualBasket(e.attr("data-iblockid"))}))}function addProduct(t,a,e){$.post(arMShopOptions.SITE_DIR+"ajax/show_basket.php?action=add&id="+t,$.proxy(function(t){basketFly("open"),e.attr("data-iblockid")&&getActualBasket(e.attr("data-iblockid"))}))}function checkOut(t){t=t||window.event;var a=$(t.target).parent();return checkCounters("google")?checkoutCounter(1,a.data("text"),a.data("href")):location.href=a.data("href"),!0}var basketTimeout,totalSum,timerBasketUpdate=!1;