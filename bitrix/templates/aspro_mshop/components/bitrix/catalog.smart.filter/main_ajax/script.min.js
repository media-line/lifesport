function JCSmartFilter(a,b,c){this.ajaxURL=a,this.form=null,this.timer=null,this.cacheKey="",this.cache=[],this.viewMode=b,this.normal_url=!1,this.bindUrlToButton("set_filter",c.SEF_SET_FILTER_URL),this.sef=!0,this.bindUrlToButton("del_filter",c.SEF_DEL_FILTER_URL),c.SEF_DEL_FILTER_URL||(this.normal_url=!0)}JCSmartFilter.prototype.keyup=function(a){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),500)},JCSmartFilter.prototype.click=function(a){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),500)},JCSmartFilter.prototype.reload=function(a){if(""!==this.cacheKey)return this.timer&&clearTimeout(this.timer),void(this.timer=setTimeout(BX.delegate(function(){this.reload(a)},this),1e3));if(this.cacheKey="|",this.position=BX.pos(a,!0),this.form=BX.findParent(a,{tag:"form"}),this.form){var b=[];b[0]={name:"ajax",value:"y"},this.gatherInputsValues(b,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0));for(var c=0;c<b.length;c++)this.cacheKey+=b[c].name+":"+b[c].value+"|";if(this.cache[this.cacheKey])this.curFilterinput=a,this.postHandler(this.cache[this.cacheKey],!0);else{if(this.sef){var d=BX("set_filter"),e=BX("del_filter");d.disabled=!0,e.disabled=!0}this.curFilterinput=a,BX.ajax.loadJSON(this.ajaxURL,this.values2post(b),BX.delegate(this.postHandler,this))}}},JCSmartFilter.prototype.updateItem=function(a,b,c){if("N"===b.PROPERTY_TYPE||b.PRICE){var d=window["trackBar"+a];!d&&b.ENCODED_ID&&(d=window["trackBar"+b.ENCODED_ID]),d&&b.VALUES&&(b.VALUES.MIN&&(b.VALUES.MIN.FILTERED_VALUE?d.setMinFilteredValue(b.VALUES.MIN.FILTERED_VALUE):d.setMinFilteredValue(b.VALUES.MIN.VALUE)),b.VALUES.MAX&&(b.VALUES.MAX.FILTERED_VALUE?d.setMaxFilteredValue(b.VALUES.MAX.FILTERED_VALUE):d.setMaxFilteredValue(b.VALUES.MAX.VALUE)),"Y"==c&&(d.leftPercent=d.rightPercent=0,$("#"+b.VALUES.MIN.CONTROL_ID).val(""),$("#"+b.VALUES.MAX.CONTROL_ID).val(""),$("#left_slider_"+b.ENCODED_ID).css({left:"0%"}),$("#colorUnavailableActive_"+b.ENCODED_ID).css({left:"0%",right:"0%"}),$("#colorAvailableInactive_"+b.ENCODED_ID).css({left:"0%",right:"0%"}),$("#colorAvailableActive_"+b.ENCODED_ID).css({left:"0%",right:"0%"}),$("#right_slider_"+b.ENCODED_ID).css({right:"0%"})))}else if(b.VALUES)for(var e in b.VALUES)if(b.VALUES.hasOwnProperty(e)){var f=b.VALUES[e],g=BX(f.CONTROL_ID);if(g){var h=document.querySelector('[data-role="label_'+f.CONTROL_ID+'"]');input=document.querySelector('[name="'+f.CONTROL_ID+'"]'),f.DISABLED?h?(BX.addClass(h,"disabled"),input&&(input.setAttribute("disabled","disabled"),BX.addClass(input,"disabled"))):BX.addClass(g.parentNode,"disabled"):h?(BX.removeClass(h,"disabled"),input&&(input.removeAttribute("disabled"),BX.removeClass(input,"disabled")),$(g)&&($(g).prop("disabled",!1),$(g).removeClass("disabled")),$(h).find("span").removeClass("disabled")):BX.removeClass(g.parentNode,"disabled"),"Y"==c&&("checkbox"!=$(g).attr("type")&&"radio"!=$(g).attr("type")||$(g).attr("checked")&&$(g).prop("checked",!1)),f.hasOwnProperty("ELEMENT_COUNT")&&(h=document.querySelector('[data-role="count_'+f.CONTROL_ID+'"]'),h&&(h.innerHTML=f.ELEMENT_COUNT))}}},JCSmartFilter.prototype.postHandlerAjax=function(a,b){$("#content").html(a)},JCSmartFilter.prototype.setUrlSortDisplay=function(a){var b="",c="";$(".sort_btn").each(function(){b=$(this).attr("href").split("?"),b[0]=a,c=b.join("?"),$(this).attr("href",c)})},JCSmartFilter.prototype.filterCatalog=function(a,b){window.History.enabled||null!=window.history.pushState?window.History.pushState(null,document.title,a):location.href=a,this.setUrlSortDisplay(a),$.ajax({url:a,type:"GET",data:{ajax_get:"Y",ajax_get_filter:"Y"},success:function(a){if($(".countdown").countdown("toggle"),$(".display_list").length?$(".display_list").html(a):$(".catalog_block").length?($(".catalog_block").html(a),touchItemBlock(".catalog_item a"),$(".catalog_block").ready(function(){$(".catalog_block").equalize({children:".catalog_item .cost",reset:!0}),$(".catalog_block").equalize({children:".catalog_item .item-title",reset:!0}),$(".catalog_block").equalize({children:".catalog_item .counter_block",reset:!0}),$(".catalog_block").equalize({children:".catalog_item_wrapp",reset:!0})})):$(".module_products_list").length&&$(".module_products_list tbody").html(a),setStatusButton(),BX.onCustomEvent("onAjaxSuccess"),$(a).find(".bottom_nav").size()?($(".module_products_list").length?($(".bottom_nav").length<2&&$(".bottom_nav").insertAfter($(".module_products_list")),$(".bottom_nav").show()):$(".bottom_nav").length<2&&($(".top_wrapper").length?$(".bottom_nav").insertAfter($(".top_wrapper")):$(".display_list").length&&$(".bottom_nav").insertAfter($(".display_list"))),$(".bottom_nav").html($(a).find(".bottom_nav").html())):$(".bottom_nav").html(""),"Y"==b){var c=BX("set_filter"),d=BX("del_filter");c.disabled=!1,d.disabled=!1}}})},JCSmartFilter.prototype.postHandler=function(a,b){var c,d,f=BX("modef"),g=BX("modef_mobile"),h=BX("modef_num"),i=BX("modef_num_mobile"),j="N";if("RESET_FORM"in a&&(document.getElementById("smartfilter").reset(),j="Y"),a&&a.ITEMS){for(var k in a.ITEMS)a.ITEMS.hasOwnProperty(k)&&this.updateItem(k,a.ITEMS[k],j);"Y"==j&&$(".bx_filter_select_block").length&&$(".bx_filter_select_block").each(function(){var b=($(this).closest(".bx_filter_parameters_box").attr("property_id"),$(this).find(".input_wr_all input:first-child").data("title"));$(this).find(".bx_filter_select_text").text(b),$(this).find(".bx_filter_select_popup li label").removeClass("selected")}),f&&h&&(h.innerHTML=a.ELEMENT_COUNT,i.innerHTML=a.ELEMENT_COUNT,c=BX.findChildren(f,{tag:"A"},!0),hrefFILTER_mobile=BX.findChildren(g,{tag:"A"},!0),a.FILTER_URL&&c&&(c[0].href=BX.util.htmlspecialcharsback(a.FILTER_URL),hrefFILTER_mobile[0].href=BX.util.htmlspecialcharsback(a.FILTER_URL)),a.FILTER_AJAX_URL&&a.COMPONENT_CONTAINER_ID&&(BX.unbindAll(c[0]),BX.unbindAll(hrefFILTER_mobile[0]),BX.bind(c[0],"click",function(b){return d=BX.util.htmlspecialcharsback(a.FILTER_AJAX_URL),BX.ajax.insertToNode(d,a.COMPONENT_CONTAINER_ID),BX.PreventDefault(b)})),a.INSTANT_RELOAD&&a.COMPONENT_CONTAINER_ID?(d=BX.util.htmlspecialcharsback(a.FILTER_AJAX_URL),BX.ajax.insertToNode(d,a.COMPONENT_CONTAINER_ID)):(d=BX.util.htmlspecialcharsback(a.FILTER_AJAX_URL),this.filterCatalog(d,"N"),a.SEF_SET_FILTER_URL?this.bindUrlToButton("set_filter",a.SEF_SET_FILTER_URL):this.bindUrlToButton("set_filter",d)))}if(this.sef){var l=BX("set_filter"),m=BX("del_filter");l.disabled=!1,m.disabled=!1}b||""===this.cacheKey||(this.cache[this.cacheKey]=a),this.cacheKey=""},JCSmartFilter.prototype.bindUrlToButton=function(a,b){var c=BX(a);if(c){"submit"==c.type&&(c.type="button"),$(c).data("href",b),BX.unbindAll(c),BX.bind(c,"click",BX.proxy(function(){var a=$(c).data("href"),b=$(c).attr("id");if("del_filter"==b){var d=[],e=this.normal_url?$("form.smartfilter").attr("action"):this.ajaxURL;if(d[0]={name:"ajax",value:"y"},this.normal_url||this.gatherInputsValues(d,BX.findChildren(document.getElementById("smartfilter"),{attribute:"hidden"},!0)),d[1]={name:"reset_form",value:"y"},this.sef){var f=BX("set_filter"),g=BX("del_filter");f.disabled=!0,g.disabled=!0}BX.ajax.loadJSON(e,this.values2post(d),BX.delegate(this.postHandler,this))}else if(a){if(this.sef){var f=BX("set_filter"),g=BX("del_filter");f.disabled=!0,g.disabled=!0}this.filterCatalog(a,"Y")}},this))}},JCSmartFilter.prototype.gatherInputsValues=function(a,b){if(b)for(var c=0;c<b.length;c++){var d=b[c];if(!d.disabled&&d.type)switch(d.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":d.value.length&&(a[a.length]={name:d.name,value:d.value});break;case"radio":case"checkbox":d.checked&&(a[a.length]={name:d.name,value:d.value});break;case"select-multiple":for(var e=0;e<d.options.length;e++)d.options[e].selected&&(a[a.length]={name:d.name,value:d.options[e].value})}}},JCSmartFilter.prototype.values2post=function(a){for(var b=[],c=b,d=0;d<a.length;){var e=a[d].name.indexOf("[");if(e==-1)c[a[d].name]=a[d].value,c=b,d++;else{var f=a[d].name.substring(0,e),g=a[d].name.substring(e+1);c[f]||(c[f]=[]);var h=g.indexOf("]");h==-1?(c=b,d++):0==h?(c=c[f],a[d].name=""+c.length):(c=c[f],a[d].name=g.substring(0,h)+g.substring(h+1))}}return b},JCSmartFilter.prototype.hideFilterProps=function(a){var b=a.parentNode,c=b.querySelector("[data-role='bx_filter_block']"),d=b.querySelector("[data-role='prop_angle']");if(BX.hasClass(b,"bx-active"))new BX.easing({duration:300,start:{opacity:1,height:c.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.transitions.quart,step:function(a){c.style.opacity=a.opacity,c.style.height=a.height+"px"},complete:function(){c.setAttribute("style",""),BX.removeClass(b,"bx-active")}}).animate(),BX.addClass(d,"fa-angle-down"),BX.removeClass(d,"fa-angle-up");else{c.style.display="block",c.style.opacity=0,c.style.height="auto";var e=c.offsetHeight;c.style.height=0,new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:e},transition:BX.easing.transitions.quart,step:function(a){c.style.opacity=a.opacity,c.style.height=a.height+"px"},complete:function(){}}).animate(),BX.addClass(b,"bx-active"),BX.removeClass(d,"fa-angle-down"),BX.addClass(d,"fa-angle-up")}},JCSmartFilter.prototype.showDropDownPopup=function(a,b){var c=a.querySelector('[data-role="dropdownContent"]'),d=$(a).offset();BX.PopupWindowManager.create("smartFilterDropDown"+b,a,{autoHide:!0,offsetLeft:0,offsetTop:0,overlay:!1,draggable:{restrict:!0},closeByEsc:!0,content:c}).show(),$("#smartFilterDropDown"+b).css({top:d.top+30,left:d.left})},JCSmartFilter.prototype.selectDropDownItem=function(a,b){if(!BX.hasClass(a,"disabled")){this.keyup(BX(b));var c=BX.findParent(BX(b),{className:"bx_filter_select_container"},!1),d=c.querySelector('[data-role="currentOption"]');d.innerHTML=a.innerHTML,$(a).closest(".bx_filter_select_popup").find("label").removeClass("selected"),BX.addClass(a,"selected"),BX.PopupWindowManager.getCurrentPopup().close()}},BX.namespace("BX.Iblock.SmartFilter"),BX.Iblock.SmartFilter=function(){var a=function(a){"object"==typeof a&&(this.leftSlider=BX(a.leftSlider),this.rightSlider=BX(a.rightSlider),this.tracker=BX(a.tracker),this.trackerWrap=BX(a.trackerWrap),this.minInput=BX(a.minInputId),this.maxInput=BX(a.maxInputId),this.minPrice=parseFloat(a.minPrice),this.maxPrice=parseFloat(a.maxPrice),this.curMinPrice=parseFloat(a.curMinPrice),this.curMaxPrice=parseFloat(a.curMaxPrice),this.fltMinPrice=a.fltMinPrice?parseFloat(a.fltMinPrice):parseFloat(a.curMinPrice),this.fltMaxPrice=a.fltMaxPrice?parseFloat(a.fltMaxPrice):parseFloat(a.curMaxPrice),this.precision=a.precision||0,this.priceDiff=this.maxPrice-this.minPrice,this.leftPercent=0,this.rightPercent=0,this.fltMinPercent=0,this.fltMaxPercent=0,this.colorUnavailableActive=BX(a.colorUnavailableActive),this.colorAvailableActive=BX(a.colorAvailableActive),this.colorAvailableInactive=BX(a.colorAvailableInactive),this.isTouch=!1,this.init(),"ontouchstart"in document.documentElement||"ontouchstart"in window?(this.isTouch=!0,BX.bind(this.leftSlider,"touchstart",BX.proxy(function(a){this.onMoveLeftSlider(a)},this)),BX.bind(this.rightSlider,"touchstart",BX.proxy(function(a){this.onMoveRightSlider(a)},this)),BX.bind(this.colorAvailableActive,"touchstart",BX.proxy(function(a){this.onChangeLeftSlider(a)},this)),BX.bind(this.colorUnavailableActive,"touchstart",BX.proxy(function(a){this.onChangeLeftSlider(a)},this)),BX.bind(this.colorAvailableInactive,"touchstart",BX.proxy(function(a){this.onChangeLeftSlider(a)},this))):(BX.bind(this.leftSlider,"mousedown",BX.proxy(function(a){this.onMoveLeftSlider(a)},this)),BX.bind(this.rightSlider,"mousedown",BX.proxy(function(a){this.onMoveRightSlider(a)},this)),BX.bind(this.colorAvailableActive,"mousedown",BX.proxy(function(a){this.onChangeLeftSlider(a)},this)),BX.bind(this.colorUnavailableActive,"mousedown",BX.proxy(function(a){this.onChangeLeftSlider(a)},this)),BX.bind(this.colorAvailableInactive,"mousedown",BX.proxy(function(a){this.onChangeLeftSlider(a)},this))),BX.bind(this.minInput,"keyup",BX.proxy(function(a){this.onInputChange()},this)),BX.bind(this.maxInput,"keyup",BX.proxy(function(a){this.onInputChange()},this)))};return a.prototype.init=function(){var a;this.curMinPrice>this.minPrice&&(a=this.curMinPrice-this.minPrice,this.leftPercent=100*a/this.priceDiff,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%"),this.setMinFilteredValue(this.fltMinPrice),this.curMaxPrice<this.maxPrice&&(a=this.maxPrice-this.curMaxPrice,this.rightPercent=100*a/this.priceDiff,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%"),this.setMaxFilteredValue(this.fltMaxPrice)},a.prototype.setMinFilteredValue=function(a){if(this.fltMinPrice=parseFloat(a),this.fltMinPrice>=this.minPrice){var b=this.fltMinPrice-this.minPrice;this.fltMinPercent=100*b/this.priceDiff,this.leftPercent>this.fltMinPercent?this.colorAvailableActive.style.left=this.leftPercent+"%":this.colorAvailableActive.style.left=this.fltMinPercent+"%",this.colorAvailableInactive.style.left=this.fltMinPercent+"%"}else this.colorAvailableActive.style.left="0%",this.colorAvailableInactive.style.left="0%"},a.prototype.setMaxFilteredValue=function(a){if(this.fltMaxPrice=parseFloat(a),this.fltMaxPrice<=this.maxPrice){var b=this.maxPrice-this.fltMaxPrice;this.fltMaxPercent=100*b/this.priceDiff,this.rightPercent>this.fltMaxPercent?this.colorAvailableActive.style.right=this.rightPercent+"%":this.colorAvailableActive.style.right=this.fltMaxPercent+"%",this.colorAvailableInactive.style.right=this.fltMaxPercent+"%"}else this.colorAvailableActive.style.right="0%",this.colorAvailableInactive.style.right="0%"},a.prototype.getXCoord=function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageXOffset||d.scrollLeft||c.scrollLeft,f=d.clientLeft||c.clientLeft||0,g=b.left+e-f;return Math.round(g)},a.prototype.getPageX=function(a){a=a||window.event;var b=null;if(this.isTouch&&null!=a.targetTouches[0])b=a.targetTouches[0].pageX;else if(null!=a.pageX)b=a.pageX;else if(null!=a.clientX){var c=document.documentElement,d=document.body;b=a.clientX+(c.scrollLeft||d&&d.scrollLeft||0),b-=c.clientLeft||0}return b},a.prototype.recountMinPrice=function(){var a=this.priceDiff*this.leftPercent/100;a=(this.minPrice+a).toFixed(this.precision),a!=this.minPrice?this.minInput.value=a:this.minInput.value="",smartFilter.keyup(this.minInput)},a.prototype.recountMaxPrice=function(){var a=this.priceDiff*this.rightPercent/100;a=(this.maxPrice-a).toFixed(this.precision),a!=this.maxPrice?this.maxInput.value=a:this.maxInput.value="",smartFilter.keyup(this.maxInput)},a.prototype.onInputChange=function(){var a;if(this.minInput.value){var b=this.minInput.value;b<this.minPrice&&(b=this.minPrice),b>this.maxPrice&&(b=this.maxPrice),a=b-this.minPrice,this.leftPercent=100*a/this.priceDiff,this.makeLeftSliderMove(!1)}if(this.maxInput.value){var c=this.maxInput.value;c<this.minPrice&&(c=this.minPrice),c>this.maxPrice&&(c=this.maxPrice),a=this.maxPrice-c,this.rightPercent=100*a/this.priceDiff,this.makeRightSliderMove(!1)}},a.prototype.makeLeftSliderMove=function(a){a=a!==!1,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%";var b=!1;this.leftPercent+this.rightPercent>=100&&(b=!0,this.rightPercent=100-this.leftPercent,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%"),this.leftPercent>=this.fltMinPercent&&this.leftPercent<=100-this.fltMaxPercent?(this.colorAvailableActive.style.left=this.leftPercent+"%",b&&(this.colorAvailableActive.style.right=100-this.leftPercent+"%")):this.leftPercent<=this.fltMinPercent?(this.colorAvailableActive.style.left=this.fltMinPercent+"%",b&&(this.colorAvailableActive.style.right=100-this.fltMinPercent+"%")):this.leftPercent>=this.fltMaxPercent&&(this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%",b&&(this.colorAvailableActive.style.right=this.fltMaxPercent+"%")),a&&(this.recountMinPrice(),b&&this.recountMaxPrice())},a.prototype.countNewLeft=function(a){var b=this.getPageX(a),c=this.getXCoord(this.trackerWrap),d=this.trackerWrap.offsetWidth,e=b-c;return e<0?e=0:e>d&&(e=d),e},a.prototype.onMoveLeftSlider=function(a){if(this.isTouch||(this.leftSlider.ondragstart=function(){return!1}),this.isTouch){var b=BX.proxy(function(a){this.leftPercent=100*this.countNewLeft(a)/this.trackerWrap.offsetWidth,this.makeLeftSliderMove()},this),c=BX.proxy(function(a){window.removeEventListener("touchmove",b,!1),window.removeEventListener("touchend",c,!1),b=c=null},this);window.addEventListener("touchmove",b,!1),window.addEventListener("touchend",c,!1)}else document.onmousemove=BX.proxy(function(a){this.leftPercent=100*this.countNewLeft(a)/this.trackerWrap.offsetWidth,this.makeLeftSliderMove()},this),document.onmouseup=function(){document.onmousemove=document.onmouseup=null};return!1},a.prototype.makeRightSliderMove=function(a){a=a!==!1,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%";var b=!1;this.leftPercent+this.rightPercent>=100&&(b=!0,this.leftPercent=100-this.rightPercent,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%"),100-this.rightPercent>=this.fltMinPercent&&this.rightPercent>=this.fltMaxPercent?(this.colorAvailableActive.style.right=this.rightPercent+"%",b&&(this.colorAvailableActive.style.left=100-this.rightPercent+"%")):this.rightPercent<=this.fltMaxPercent?(this.colorAvailableActive.style.right=this.fltMaxPercent+"%",b&&(this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%")):100-this.rightPercent<=this.fltMinPercent&&(this.colorAvailableActive.style.right=100-this.fltMinPercent+"%",b&&(this.colorAvailableActive.style.left=this.fltMinPercent+"%")),a&&(this.recountMaxPrice(),b&&this.recountMinPrice())},a.prototype.onMoveRightSlider=function(a){if(this.isTouch||(this.rightSlider.ondragstart=function(){return!1}),this.isTouch){var b=BX.proxy(function(a){this.rightPercent=100-100*this.countNewLeft(a)/this.trackerWrap.offsetWidth,this.makeRightSliderMove()},this),c=BX.proxy(function(a){window.removeEventListener("touchmove",b,!1),window.removeEventListener("touchend",c,!1),b=c=null},this);window.addEventListener("touchmove",b,!1),window.addEventListener("touchend",c,!1)}else document.onmousemove=BX.proxy(function(a){this.rightPercent=100-100*this.countNewLeft(a)/this.trackerWrap.offsetWidth,this.makeRightSliderMove()},this),document.onmouseup=function(){document.onmousemove=document.onmouseup=null};return!1},a.prototype.onChangeLeftSlider=function(a){if(this.isTouch||(this.leftSlider.ondragstart=function(){}),this.isTouch){var b=100*this.countNewLeft(a)/this.trackerWrap.offsetWidth;if($(a.target).is(".bx_ui_slider_handle"))return;b<50?(this.leftPercent=b,this.makeLeftSliderMove()):(this.rightPercent=100-b,this.makeRightSliderMove())}else document.onmousedown=BX.proxy(function(a){var b=100*this.countNewLeft(a)/this.trackerWrap.offsetWidth;!$(a.target).is(".bx_ui_slider_handle")&&$(a.target).is("[class^=bx_ui_slider]")&&(b<50?(this.leftPercent=b+1,this.makeLeftSliderMove()):(this.rightPercent=100-b,this.makeRightSliderMove()))},this),document.onmouseup=function(){document.onmousemove=document.onmouseup=null};return!1},a}();